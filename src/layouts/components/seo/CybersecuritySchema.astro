---
import parseTomlToJson from "@/lib/utils/parseTomlToJson";

const config = parseTomlToJson("./src/config/config.toml");

interface CybersecuritySchemaProps {
  pageType?: 'homepage' | 'service' | 'pricing' | 'contact' | 'blog';
  title?: string;
  description?: string;
  serviceName?: string;
  price?: string;
  currency?: string;
}

const {
  pageType = 'homepage',
  title,
  description,
  serviceName,
  price,
  currency = 'USD'
} = Astro.props as CybersecuritySchemaProps;

const baseUrl = config.site.base_url;
const currentUrl = new URL(Astro.url.pathname, Astro.site).href;

// Enhanced Organization Schema for Cybersecurity
const cybersecurityOrganizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  "@id": `${baseUrl}#organization`,
  "name": "Nubesti",
  "url": baseUrl,
  "logo": {
    "@type": "ImageObject",
    "url": `${baseUrl}/images/logo-nubesti.svg`,
    "width": 300,
    "height": 100
  },
  "description": "Leading AI-powered cybersecurity platform for autonomous penetration testing, red team operations, and vulnerability assessment using MITRE ATT&CK framework",
  "foundingDate": "2024",
  "industry": ["Cybersecurity", "Information Security", "Software", "Artificial Intelligence"],
  "knowsAbout": [
    "Penetration Testing",
    "Red Team Operations", 
    "MITRE ATT&CK Framework",
    "OWASP Security Testing",
    "Vulnerability Assessment",
    "AI-Powered Security",
    "Autonomous Testing",
    "Compliance Testing",
    "SOC 2 Type II",
    "ISO 27001/27002",
    "PCI DSS",
    "HIPAA Security",
    "NIST Cybersecurity Framework",
    "Zero Trust Architecture",
    "DevSecOps",
    "Cloud Security (AWS, Azure, GCP)",
    "API Security Testing",
    "Network Security Assessment",
    "Advanced Persistent Threat (APT) Simulation",
    "Threat Intelligence",
    "Security Automation",
    "SIEM Integration",
    "Incident Response",
    "Risk Assessment"
  ],
  "serviceArea": {
    "@type": "Place",
    "name": "Global"
  },
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "@id": `${baseUrl}#offerCatalog`,
    "name": "Cybersecurity Solutions",
    "itemListElement": [
      {
        "@type": "Offer",
        "@id": `${baseUrl}/pricing#redteam`,
        "name": "AI Red Team Platform",
        "description": "Autonomous red team operations using AI and MITRE ATT&CK framework for continuous security testing",
        "category": "Cybersecurity Service",
        "itemOffered": {
          "@type": "Service",
          "name": "AI-Powered Red Team Operations",
          "serviceType": "Cybersecurity Testing",
          "provider": {
            "@type": "Organization",
            "name": "Nubesti"
          }
        }
      },
      {
        "@type": "Offer",
        "@id": `${baseUrl}/pricing#pentest`,
        "name": "Automated Penetration Testing", 
        "description": "Continuous penetration testing with automated vulnerability discovery and exploitation",
        "category": "Security Testing",
        "itemOffered": {
          "@type": "Service",
          "name": "Automated Penetration Testing",
          "serviceType": "Security Assessment"
        }
      },
      {
        "@type": "Offer",
        "@id": `${baseUrl}/pricing#compliance`,
        "name": "Compliance Testing",
        "description": "Automated compliance testing for SOC 2, ISO 27001, PCI DSS, HIPAA, and NIST frameworks",
        "category": "Compliance Assessment",
        "itemOffered": {
          "@type": "Service",
          "name": "Compliance Testing Services",
          "serviceType": "Regulatory Compliance"
        }
      }
    ]
  },
  "contactPoint": [
    {
      "@type": "ContactPoint",
      "telephone": "+57-320-545-1915",
      "contactType": "Customer Service",
      "email": "alexis@nubesti.com",
      "availableLanguage": ["English", "Spanish", "French"],
      "contactOption": "TollFree"
    },
    {
      "@type": "ContactPoint",
      "email": "security@nubesti.com",
      "contactType": "Technical Support",
      "availableLanguage": ["English", "Spanish", "French"]
    }
  ],
  "sameAs": [
    "https://twitter.com/nubesti",
    "https://linkedin.com/company/nubesti", 
    "https://github.com/nubesti"
  ],
  "location": {
    "@type": "Place",
    "name": "Global Operations",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "Global"
    }
  }
};

// Professional Service Schema for Cybersecurity
const professionalServiceSchema = {
  "@context": "https://schema.org",
  "@type": "ProfessionalService",
  "@id": `${baseUrl}#professionalService`,
  "name": "Nubesti Cybersecurity Services",
  "url": baseUrl,
  "description": "Professional cybersecurity services including AI-powered penetration testing, red team operations, and compliance testing",
  "provider": {
    "@type": "Organization",
    "@id": `${baseUrl}#organization`
  },
  "serviceType": "Cybersecurity",
  "category": [
    "Information Security",
    "Penetration Testing", 
    "Red Team Operations",
    "Vulnerability Assessment",
    "Compliance Testing"
  ],
  "hasOfferCatalog": {
    "@type": "OfferCatalog",
    "itemListElement": [
      {
        "@type": "Offer",
        "name": "Enterprise Security Testing",
        "description": "Comprehensive security testing for enterprise environments",
        "category": "Enterprise Security"
      },
      {
        "@type": "Offer", 
        "name": "Cloud Security Assessment",
        "description": "Multi-cloud security testing for AWS, Azure, and GCP environments",
        "category": "Cloud Security"
      },
      {
        "@type": "Offer",
        "name": "DevSecOps Integration",
        "description": "Continuous security testing integration with CI/CD pipelines",
        "category": "DevSecOps"
      }
    ]
  },
  "audience": {
    "@type": "Audience",
    "audienceType": ["Enterprise", "Technology Companies", "Financial Services", "Healthcare Organizations"],
    "geographicArea": {
      "@type": "Place",
      "name": "Global"
    }
  },
  "areaServed": {
    "@type": "Place", 
    "name": "Worldwide"
  }
};

// Software Application Schema for AI Platform
const softwareApplicationSchema = {
  "@context": "https://schema.org",
  "@type": "SoftwareApplication",
  "@id": `${baseUrl}#software`,
  "name": "Nubesti AI Red Team Platform",
  "url": baseUrl,
  "description": "AI-powered autonomous red team platform for continuous cybersecurity testing and vulnerability assessment",
  "applicationCategory": "SecurityApplication",
  "operatingSystem": ["Web Browser", "SaaS", "Cloud"],
  "creator": {
    "@type": "Organization",
    "@id": `${baseUrl}#organization`
  },
  "publisher": {
    "@type": "Organization", 
    "@id": `${baseUrl}#organization`
  },
  "downloadUrl": `${baseUrl}/contact/`,
  "installUrl": `${baseUrl}/contact/`,
  "screenshot": `${baseUrl}/images/nubesti-ai-red-team-dashboard.webp`,
  "featureList": [
    "Autonomous AI-powered testing",
    "MITRE ATT&CK framework integration",
    "OWASP compliance testing",
    "Continuous vulnerability assessment",
    "Real-time threat simulation",
    "Automated report generation",
    "Multi-cloud support (AWS, Azure, GCP)",
    "DevSecOps integration",
    "Compliance framework support"
  ],
  "requirements": "Modern web browser",
  "releaseNotes": "Latest version includes enhanced AI algorithms and expanded MITRE ATT&CK technique coverage",
  "offers": {
    "@type": "Offer",
    "price": "Contact for pricing",
    "priceCurrency": "USD",
    "availability": "https://schema.org/InStock",
    "seller": {
      "@type": "Organization",
      "@id": `${baseUrl}#organization`
    }
  }
};

// Technology Stack Schema
const techStackSchema = {
  "@context": "https://schema.org",
  "@type": "TechArticle",
  "@id": `${baseUrl}#techstack`,
  "name": "Nubesti Technology Stack",
  "description": "Advanced technology stack powering AI-driven cybersecurity testing",
  "about": {
    "@type": "Thing",
    "name": "Cybersecurity Technology"
  },
  "mentions": [
    {
      "@type": "SoftwareApplication",
      "name": "MITRE ATT&CK Framework"
    },
    {
      "@type": "SoftwareApplication", 
      "name": "OWASP Testing Guide"
    },
    {
      "@type": "Thing",
      "name": "Artificial Intelligence"
    },
    {
      "@type": "Thing",
      "name": "Machine Learning"
    },
    {
      "@type": "Thing",
      "name": "Natural Language Processing"
    }
  ]
};

// Compile schemas based on page type
const schemas: any[] = [cybersecurityOrganizationSchema, professionalServiceSchema];

switch (pageType) {
  case 'homepage':
    schemas.push(softwareApplicationSchema, techStackSchema);
    break;
  case 'service':
    schemas.push(softwareApplicationSchema);
    break;
  case 'pricing':
    // Add pricing-specific schema if needed
    break;
}
---

{schemas.map((schema, index) => (
  <script 
    type="application/ld+json" 
    data-schema={`cybersecurity-${index}`}
    set:html={JSON.stringify(schema, null, 2)} 
  />
))}
